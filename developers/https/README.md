# Система загрузки SSL сертификатов

## Общие сведения

По сути это работающий MVP, который при необходимости можно развивать 
в любую сторону: 
- выделить index.php в свой document_root
- добавить роутер
- подключение к БД
- строить уже полноценный MVC
- уйти от относительных путей
- добавление env-файлов для разных окружений
- общее логирование ошибок (например, в Sentry)
- отправка данных в систему инфо/дебага (например, в Graylog)
- авторизацию и сессии
- в какой-то момент потребуется управлять более чем 1 сервером nginx
- хранение файлов не в ФС одного сервера, а где-то во внешней системе
- включить проверку mime type загружаемых файлов
- добавить возможность работы с "не только" латинскими доменами
- ... 

и делать это уже можно итерационно с проверкой работоспособности.

Для работы cron-части необходимо использовать php8, для интерфейсной 
не обязательно, но на 8 будет чуть быстрее и приятнее, если потребуется 
развитие продукта :)

Был выбран "чистый" php, так как в компании фреймворки не используются, хотя 
в задании нет четкого указания можно ли поднять что-то сторонее или нет.

Данная система написана на компьютере без установленного nginx, все 
проверки выполнены в условиях далеких от боевых, обязательно требуется 
этап тестирования в условиях приближенных к боевым.

Затречено времени на разработку - 16 часов (их них 12 - на интерфейс и 
4 часа на крон скрипт).  

### Для запуска

Директория ./certs должна иметь права на запись.

### Внешний вид

Был использован css-фреймворк tailwind с плагином forms,
однако в нём не обнаружилась кастомизация инпута file,
поэтому дополнительно прикручен набор flowbite.

Но я от фронтенда далёк, поэтому шаблон честно свиснут из открытых 
источников и применён с необходимыми доработками.

### Шаблоны

Все шаблоны выделены в директорию /views. Этакий задел на MVC.

### Конфигурация

Все настройки приложения выделены в отдельный файл /config.php 

### Загрузка файлов

Что можно улучшить:
1. можно выделить всю обработку по загрузке в отдельный класс
2. для обозначение максимального размера файла на view, если будет 
необходимость увеличить больше мегабайта или гигабайта надо написать
хелпер перевода из байт в нужную размерность
3. если необходимо разделять максимальные размеры загружаемых
файлов на форме надо убрать input name="MAX_FILE_SIZE" потому что 
он работает для _всех_ файлов в рамках одной формы, и полностью 
полагаться на nginx/backend обработку
4. можно объединить в конфигурации загружаемые файлы в один массив, и везде
пробегать foreach по нему (при валидации и загрузке в директорию)
5. так же непонятно, что делать в случае повторной загрузки сертификата
для одного домена - вопрос к менеджеру больше. сейчас новые файлы просто
записываются поверх старых
6. после загрузки происходит редирект на основную страницу с GET
параметром. чтобы избавиться от него и простой ручной подстановки в
адресную строку, надо использовать сессии. Да и вообще тут нужна и БД
(так легче будет и скрипту на кроне) и статистка и т.д. :) Сессии для 
этого проекта можно хранить в ФС, но как только внезапно станет хайлоад - 
надо будет переносить с ФС куда-то (memcache, redis, ...)

### Исключения

Все исключения необходимо перехватывать и отправлять в 
соответствующую систему, при этом не показывая их содержимое
пользователю. Сейчас исключения установлены только в 2х местах, без которых
невозможно системой пользоваться в принципе. Чтобы создать нормальную работу 
всей системы основанной на исключениях необходимо уходить в сторону 
полноценного MVC построенного на классах.

### Cron

Команда для запуска cron-скрипта:
`*/5 * * * * php path-to-project-root/cron.php`, но запускать надо от 
пользователя с правами sudo без запроса пароля. Либо сразу от рута, что 
имхо не очень правильно, через команду `sudo crontab -e`, и тогда надо 
убрать слова `sudo` из команд в конфигурации.

Как еще один вариант, можно написать sh-скрипт рядом, который будет 
выставлять пользователя и запускать уже изнутри php-скрипт, но только 
в том случае, если надо поставить переменные окружения, иначе получится 
хардкод, о котором в будущем можно забыть.